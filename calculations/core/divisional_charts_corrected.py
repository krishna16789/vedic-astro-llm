"""
Corrected Divisional Chart (Varga) Calculations
Based on VedAstro reference implementation from Vargas.cs

This module provides lookup-table based implementations for D30, D45, and D60
which were found to be incorrect in the original ephemeris.py
"""

from typing import Dict, Tuple

# Zodiac sign names mapping (0-11)
SIGN_NAMES = [
    'Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo',
    'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'
]

# Sign name to index mapping
SIGN_INDEX = {name: idx for idx, name in enumerate(SIGN_NAMES)}


def _lookup_varga(
    sign_num: int, 
    degree_in_sign: float, 
    lookup_table: Dict[int, Dict[Tuple[float, float], int]],
    divisions: int
) -> Tuple[int, float]:
    """
    Generic varga lookup using precomputed tables from VedAstro
    
    Args:
        sign_num: Sign number (0-11)
        degree_in_sign: Degree within sign (0-30)
        lookup_table: Precomputed lookup table
        divisions: Number of divisions (for calculating degree within division)
    
    Returns:
        Tuple of (new_sign_num, degree_within_division)
    """
    # Get the lookup table for this sign
    sign_table = lookup_table[sign_num]
    
    # Find which degree range the planet falls in
    for (start_deg, end_deg), result_sign in sign_table.items():
        if start_deg <= degree_in_sign < end_deg:
            # Calculate degree within the division
            # Each division spans (30 / divisions) degrees
            division_size = 30.0 / divisions
            degree_within_division = (degree_in_sign - start_deg) * divisions
            
            return result_sign, degree_within_division
    
    # Fallback (should never reach here with correct tables)
    return sign_num, degree_in_sign


# ============================================================================
# D45 - AKSHAVEDAMSHA TABLE (One-fortyfifth of a sign - 0°40' per division)
# ============================================================================
# Source: VedAstro/Library/Logic/Calculate/Vargas.cs lines 2466-3032
# Pattern: Based on element (triplicity)
# - Fire signs (Aries, Leo, Sagittarius): Start sequence Aries, Leo, Sagittarius
# - Earth signs (Taurus, Virgo, Capricorn): Start sequence Leo, Sagittarius, Aries
# - Air signs (Gemini, Libra, Aquarius): Start sequence Sagittarius, Aries, Leo
# - Water signs (Cancer, Scorpio, Pisces): Start sequence Aries, Leo, Sagittarius

D45_TABLE = {
    # Aries (Fire) - starts at Aries
    0: {
        (0, 0.6667): 0, (0.6667, 1.3333): 1, (1.3333, 2): 2, (2, 2.6667): 3,
        (2.6667, 3.3333): 4, (3.3333, 4): 5, (4, 4.6667): 6, (4.6667, 5.3333): 7,
        (5.3333, 6): 8, (6, 6.6667): 9, (6.6667, 7.3333): 10, (7.3333, 8): 11,
        (8, 8.6667): 0, (8.6667, 9.3333): 1, (9.3333, 10): 2, (10, 10.6667): 3,
        (10.6667, 11.3333): 4, (11.3333, 12): 5, (12, 12.6667): 6, (12.6667, 13.3333): 7,
        (13.3333, 14): 8, (14, 14.6667): 9, (14.6667, 15.3333): 10, (15.3333, 16): 11,
        (16, 16.6667): 0, (16.6667, 17.3333): 1, (17.3333, 18): 2, (18, 18.6667): 3,
        (18.6667, 19.3333): 4, (19.3333, 20): 5, (20, 20.6667): 6, (20.6667, 21.3333): 7,
        (21.3333, 22): 8, (22, 22.6667): 9, (22.6667, 23.3333): 10, (23.3333, 24): 11,
        (24, 24.6667): 0, (24.6667, 25.3333): 1, (25.3333, 26): 2, (26, 26.6667): 3,
        (26.6667, 27.3333): 4, (27.3333, 28): 5, (28, 28.6667): 6, (28.6667, 29.3333): 7,
        (29.3333, 30): 8
    },
    # Taurus (Earth) - starts at Leo
    1: {
        (0, 0.6667): 4, (0.6667, 1.3333): 5, (1.3333, 2): 6, (2, 2.6667): 7,
        (2.6667, 3.3333): 8, (3.3333, 4): 9, (4, 4.6667): 10, (4.6667, 5.3333): 11,
        (5.3333, 6): 0, (6, 6.6667): 1, (6.6667, 7.3333): 2, (7.3333, 8): 3,
        (8, 8.6667): 4, (8.6667, 9.3333): 5, (9.3333, 10): 6, (10, 10.6667): 7,
        (10.6667, 11.3333): 8, (11.3333, 12): 9, (12, 12.6667): 10, (12.6667, 13.3333): 11,
        (13.3333, 14): 0, (14, 14.6667): 1, (14.6667, 15.3333): 2, (15.3333, 16): 3,
        (16, 16.6667): 4, (16.6667, 17.3333): 5, (17.3333, 18): 6, (18, 18.6667): 7,
        (18.6667, 19.3333): 8, (19.3333, 20): 9, (20, 20.6667): 10, (20.6667, 21.3333): 11,
        (21.3333, 22): 0, (22, 22.6667): 1, (22.6667, 23.3333): 2, (23.3333, 24): 3,
        (24, 24.6667): 4, (24.6667, 25.3333): 5, (25.3333, 26): 6, (26, 26.6667): 7,
        (26.6667, 27.3333): 8, (27.3333, 28): 9, (28, 28.6667): 10, (28.6667, 29.3333): 11,
        (29.3333, 30): 0
    },
    # Gemini (Air) - starts at Sagittarius
    2: {
        (0, 0.6667): 8, (0.6667, 1.3333): 9, (1.3333, 2): 10, (2, 2.6667): 11,
        (2.6667, 3.3333): 0, (3.3333, 4): 1, (4, 4.6667): 2, (4.6667, 5.3333): 3,
        (5.3333, 6): 4, (6, 6.6667): 5, (6.6667, 7.3333): 6, (7.3333, 8): 7,
        (8, 8.6667): 8, (8.6667, 9.3333): 9, (9.3333, 10): 10, (10, 10.6667): 11,
        (10.6667, 11.3333): 0, (11.3333, 12): 1, (12, 12.6667): 2, (12.6667, 13.3333): 3,
        (13.3333, 14): 4, (14, 14.6667): 5, (14.6667, 15.3333): 6, (15.3333, 16): 7,
        (16, 16.6667): 8, (16.6667, 17.3333): 9, (17.3333, 18): 10, (18, 18.6667): 11,
        (18.6667, 19.3333): 0, (19.3333, 20): 1, (20, 20.6667): 2, (20.6667, 21.3333): 3,
        (21.3333, 22): 4, (22, 22.6667): 5, (22.6667, 23.3333): 6, (23.3333, 24): 7,
        (24, 24.6667): 8, (24.6667, 25.3333): 9, (25.3333, 26): 10, (26, 26.6667): 11,
        (26.6667, 27.3333): 0, (27.3333, 28): 1, (28, 28.6667): 2, (28.6667, 29.3333): 3,
        (29.3333, 30): 4
    },
    # Cancer (Water) - starts at Aries
    3: {
        (0, 0.6667): 0, (0.6667, 1.3333): 1, (1.3333, 2): 2, (2, 2.6667): 3,
        (2.6667, 3.3333): 4, (3.3333, 4): 5, (4, 4.6667): 6, (4.6667, 5.3333): 7,
        (5.3333, 6): 8, (6, 6.6667): 9, (6.6667, 7.3333): 10, (7.3333, 8): 11,
        (8, 8.6667): 0, (8.6667, 9.3333): 1, (9.3333, 10): 2, (10, 10.6667): 3,
        (10.6667, 11.3333): 4, (11.3333, 12): 5, (12, 12.6667): 6, (12.6667, 13.3333): 7,
        (13.3333, 14): 8, (14, 14.6667): 9, (14.6667, 15.3333): 10, (15.3333, 16): 11,
        (16, 16.6667): 0, (16.6667, 17.3333): 1, (17.3333, 18): 2, (18, 18.6667): 3,
        (18.6667, 19.3333): 4, (19.3333, 20): 5, (20, 20.6667): 6, (20.6667, 21.3333): 7,
        (21.3333, 22): 8, (22, 22.6667): 9, (22.6667, 23.3333): 10, (23.3333, 24): 11,
        (24, 24.6667): 0, (24.6667, 25.3333): 1, (25.3333, 26): 2, (26, 26.6667): 3,
        (26.6667, 27.3333): 4, (27.3333, 28): 5, (28, 28.6667): 6, (28.6667, 29.3333): 7,
        (29.3333, 30): 8
    },
    # Leo (Fire) - starts at Leo
    4: {
        (0, 0.6667): 4, (0.6667, 1.3333): 5, (1.3333, 2): 6, (2, 2.6667): 7,
        (2.6667, 3.3333): 8, (3.3333, 4): 9, (4, 4.6667): 10, (4.6667, 5.3333): 11,
        (5.3333, 6): 0, (6, 6.6667): 1, (6.6667, 7.3333): 2, (7.3333, 8): 3,
        (8, 8.6667): 4, (8.6667, 9.3333): 5, (9.3333, 10): 6, (10, 10.6667): 7,
        (10.6667, 11.3333): 8, (11.3333, 12): 9, (12, 12.6667): 10, (12.6667, 13.3333): 11,
        (13.3333, 14): 0, (14, 14.6667): 1, (14.6667, 15.3333): 2, (15.3333, 16): 3,
        (16, 16.6667): 4, (16.6667, 17.3333): 5, (17.3333, 18): 6, (18, 18.6667): 7,
        (18.6667, 19.3333): 8, (19.3333, 20): 9, (20, 20.6667): 10, (20.6667, 21.3333): 11,
        (21.3333, 22): 0, (22, 22.6667): 1, (22.6667, 23.3333): 2, (23.3333, 24): 3,
        (24, 24.6667): 4, (24.6667, 25.3333): 5, (25.3333, 26): 6, (26, 26.6667): 7,
        (26.6667, 27.3333): 8, (27.3333, 28): 9, (28, 28.6667): 10, (28.6667, 29.3333): 11,
        (29.3333, 30): 0
    },
    # Virgo (Earth) - starts at Sagittarius
    5: {
        (0, 0.6667): 8, (0.6667, 1.3333): 9, (1.3333, 2): 10, (2, 2.6667): 11,
        (2.6667, 3.3333): 0, (3.3333, 4): 1, (4, 4.6667): 2, (4.6667, 5.3333): 3,
        (5.3333, 6): 4, (6, 6.6667): 5, (6.6667, 7.3333): 6, (7.3333, 8): 7,
        (8, 8.6667): 8, (8.6667, 9.3333): 9, (9.3333, 10): 10, (10, 10.6667): 11,
        (10.6667, 11.3333): 0, (11.3333, 12): 1, (12, 12.6667): 2, (12.6667, 13.3333): 3,
        (13.3333, 14): 4, (14, 14.6667): 5, (14.6667, 15.3333): 6, (15.3333, 16): 7,
        (16, 16.6667): 8, (16.6667, 17.3333): 9, (17.3333, 18): 10, (18, 18.6667): 11,
        (18.6667, 19.3333): 0, (19.3333, 20): 1, (20, 20.6667): 2, (20.6667, 21.3333): 3,
        (21.3333, 22): 4, (22, 22.6667): 5, (22.6667, 23.3333): 6, (23.3333, 24): 7,
        (24, 24.6667): 8, (24.6667, 25.3333): 9, (25.3333, 26): 10, (26, 26.6667): 11,
        (26.6667, 27.3333): 0, (27.3333, 28): 1, (28, 28.6667): 2, (28.6667, 29.3333): 3,
        (29.3333, 30): 4
    },
    # Libra (Air) - starts at Aries
    6: {
        (0, 0.6667): 0, (0.6667, 1.3333): 1, (1.3333, 2): 2, (2, 2.6667): 3,
        (2.6667, 3.3333): 4, (3.3333, 4): 5, (4, 4.6667): 6, (4.6667, 5.3333): 7,
        (5.3333, 6): 8, (6, 6.6667): 9, (6.6667, 7.3333): 10, (7.3333, 8): 11,
        (8, 8.6667): 0, (8.6667, 9.3333): 1, (9.3333, 10): 2, (10, 10.6667): 3,
        (10.6667, 11.3333): 4, (11.3333, 12): 5, (12, 12.6667): 6, (12.6667, 13.3333): 7,
        (13.3333, 14): 8, (14, 14.6667): 9, (14.6667, 15.3333): 10, (15.3333, 16): 11,
        (16, 16.6667): 0, (16.6667, 17.3333): 1, (17.3333, 18): 2, (18, 18.6667): 3,
        (18.6667, 19.3333): 4, (19.3333, 20): 5, (20, 20.6667): 6, (20.6667, 21.3333): 7,
        (21.3333, 22): 8, (22, 22.6667): 9, (22.6667, 23.3333): 10, (23.3333, 24): 11,
        (24, 24.6667): 0, (24.6667, 25.3333): 1, (25.3333, 26): 2, (26, 26.6667): 3,
        (26.6667, 27.3333): 4, (27.3333, 28): 5, (28, 28.6667): 6, (28.6667, 29.3333): 7,
        (29.3333, 30): 8
    },
    # Scorpio (Water) - starts at Leo
    7: {
        (0, 0.6667): 4, (0.6667, 1.3333): 5, (1.3333, 2): 6, (2, 2.6667): 7,
        (2.6667, 3.3333): 8, (3.3333, 4): 9, (4, 4.6667): 10, (4.6667, 5.3333): 11,
        (5.3333, 6): 0, (6, 6.6667): 1, (6.6667, 7.3333): 2, (7.3333, 8): 3,
        (8, 8.6667): 4, (8.6667, 9.3333): 5, (9.3333, 10): 6, (10, 10.6667): 7,
        (10.6667, 11.3333): 8, (11.3333, 12): 9, (12, 12.6667): 10, (12.6667, 13.3333): 11,
        (13.3333, 14): 0, (14, 14.6667): 1, (14.6667, 15.3333): 2, (15.3333, 16): 3,
        (16, 16.6667): 4, (16.6667, 17.3333): 5, (17.3333, 18): 6, (18, 18.6667): 7,
        (18.6667, 19.3333): 8, (19.3333, 20): 9, (20, 20.6667): 10, (20.6667, 21.3333): 11,
        (21.3333, 22): 0, (22, 22.6667): 1, (22.6667, 23.3333): 2, (23.3333, 24): 3,
        (24, 24.6667): 4, (24.6667, 25.3333): 5, (25.3333, 26): 6, (26, 26.6667): 7,
        (26.6667, 27.3333): 8, (27.3333, 28): 9, (28, 28.6667): 10, (28.6667, 29.3333): 11,
        (29.3333, 30): 0
    },
    # Sagittarius (Fire) - starts at Sagittarius
    8: {
        (0, 0.6667): 8, (0.6667, 1.3333): 9, (1.3333, 2): 10, (2, 2.6667): 11,
        (2.6667, 3.3333): 0, (3.3333, 4): 1, (4, 4.6667): 2, (4.6667, 5.3333): 3,
        (5.3333, 6): 4, (6, 6.6667): 5, (6.6667, 7.3333): 6, (7.3333, 8): 7,
        (8, 8.6667): 8, (8.6667, 9.3333): 9, (9.3333, 10): 10, (10, 10.6667): 11,
        (10.6667, 11.3333): 0, (11.3333, 12): 1, (12, 12.6667): 2, (12.6667, 13.3333): 3,
        (13.3333, 14): 4, (14, 14.6667): 5, (14.6667, 15.3333): 6, (15.3333, 16): 7,
        (16, 16.6667): 8, (16.6667, 17.3333): 9, (17.3333, 18): 10, (18, 18.6667): 11,
        (18.6667, 19.3333): 0, (19.3333, 20): 1, (20, 20.6667): 2, (20.6667, 21.3333): 3,
        (21.3333, 22): 4, (22, 22.6667): 5, (22.6667, 23.3333): 6, (23.3333, 24): 7,
        (24, 24.6667): 8, (24.6667, 25.3333): 9, (25.3333, 26): 10, (26, 26.6667): 11,
        (26.6667, 27.3333): 0, (27.3333, 28): 1, (28, 28.6667): 2, (28.6667, 29.3333): 3,
        (29.3333, 30): 4
    },
    # Capricorn (Earth) - starts at Aries
    9: {
        (0, 0.6667): 0, (0.6667, 1.3333): 1, (1.3333, 2): 2, (2, 2.6667): 3,
        (2.6667, 3.3333): 4, (3.3333, 4): 5, (4, 4.6667): 6, (4.6667, 5.3333): 7,
        (5.3333, 6): 8, (6, 6.6667): 9, (6.6667, 7.3333): 10, (7.3333, 8): 11,
        (8, 8.6667): 0, (8.6667, 9.3333): 1, (9.3333, 10): 2, (10, 10.6667): 3,
        (10.6667, 11.3333): 4, (11.3333, 12): 5, (12, 12.6667): 6, (12.6667, 13.3333): 7,
        (13.3333, 14): 8, (14, 14.6667): 9, (14.6667, 15.3333): 10, (15.3333, 16): 11,
        (16, 16.6667): 0, (16.6667, 17.3333): 1, (17.3333, 18): 2, (18, 18.6667): 3,
        (18.6667, 19.3333): 4, (19.3333, 20): 5, (20, 20.6667): 6, (20.6667, 21.3333): 7,
        (21.3333, 22): 8, (22, 22.6667): 9, (22.6667, 23.3333): 10, (23.3333, 24): 11,
        (24, 24.6667): 0, (24.6667, 25.3333): 1, (25.3333, 26): 2, (26, 26.6667): 3,
        (26.6667, 27.3333): 4, (27.3333, 28): 5, (28, 28.6667): 6, (28.6667, 29.3333): 7,
        (29.3333, 30): 8
    },
    # Aquarius (Air) - starts at Leo
    10: {
        (0, 0.6667): 4, (0.6667, 1.3333): 5, (1.3333, 2): 6, (2, 2.6667): 7,
        (2.6667, 3.3333): 8, (3.3333, 4): 9, (4, 4.6667): 10, (4.6667, 5.3333): 11,
        (5.3333, 6): 0, (6, 6.6667): 1, (6.6667, 7.3333): 2, (7.3333, 8): 3,
        (8, 8.6667): 4, (8.6667, 9.3333): 5, (9.3333, 10): 6, (10, 10.6667): 7,
        (10.6667, 11.3333): 8, (11.3333, 12): 9, (12, 12.6667): 10, (12.6667, 13.3333): 11,
        (13.3333, 14): 0, (14, 14.6667): 1, (14.6667, 15.3333): 2, (15.3333, 16): 3,
        (16, 16.6667): 4, (16.6667, 17.3333): 5, (17.3333, 18): 6, (18, 18.6667): 7,
        (18.6667, 19.3333): 8, (19.3333, 20): 9, (20, 20.6667): 10, (20.6667, 21.3333): 11,
        (21.3333, 22): 0, (22, 22.6667): 1, (22.6667, 23.3333): 2, (23.3333, 24): 3,
        (24, 24.6667): 4, (24.6667, 25.3333): 5, (25.3333, 26): 6, (26, 26.6667): 7,
        (26.6667, 27.3333): 8, (27.3333, 28): 9, (28, 28.6667): 10, (28.6667, 29.3333): 11,
        (29.3333, 30): 0
    },
    # Pisces (Water) - starts at Sagittarius
    11: {
        (0, 0.6667): 8, (0.6667, 1.3333): 9, (1.3333, 2): 10, (2, 2.6667): 11,
        (2.6667, 3.3333): 0, (3.3333, 4): 1, (4, 4.6667): 2, (4.6667, 5.3333): 3,
        (5.3333, 6): 4, (6, 6.6667): 5, (6.6667, 7.3333): 6, (7.3333, 8): 7,
        (8, 8.6667): 8, (8.6667, 9.3333): 9, (9.3333, 10): 10, (10, 10.6667): 11,
        (10.6667, 11.3333): 0, (11.3333, 12): 1, (12, 12.6667): 2, (12.6667, 13.3333): 3,
        (13.3333, 14): 4, (14, 14.6667): 5, (14.6667, 15.3333): 6, (15.3333, 16): 7,
        (16, 16.6667): 8, (16.6667, 17.3333): 9, (17.3333, 18): 10, (18, 18.6667): 11,
        (18.6667, 19.3333): 0, (19.3333, 20): 1, (20, 20.6667): 2, (20.6667, 21.3333): 3,
        (21.3333, 22): 4, (22, 22.6667): 5, (22.6667, 23.3333): 6, (23.3333, 24): 7,
        (24, 24.6667): 8, (24.6667, 25.3333): 9, (25.3333, 26): 10, (26, 26.6667): 11,
        (26.6667, 27.3333): 0, (27.3333, 28): 1, (28, 28.6667): 2, (28.6667, 29.3333): 3,
        (29.3333, 30): 4
    }
}


# ============================================================================
# D60 - SHASHTYAMSHA TABLE (One-sixtieth of a sign - 0°30' per division)
# ============================================================================
# Source: VedAstro/Library/Logic/Calculate/Vargas.cs lines 3037-3784
# Pattern: Each sign starts from itself and cycles through all 12 signs 5 times
# This is the most subtle division, showing past karma and overall life

D60_TABLE = {
    # Aries - starts at Aries
    0: {
        (0, 0.5): 0, (0.5, 1): 1, (1, 1.5): 2, (1.5, 2): 3, (2, 2.5): 4, (2.5, 3): 5,
        (3, 3.5): 6, (3.5, 4): 7, (4, 4.5): 8, (4.5, 5): 9, (5, 5.5): 10, (5.5, 6): 11,
        (6, 6.5): 0, (6.5, 7): 1, (7, 7.5): 2, (7.5, 8): 3, (8, 8.5): 4, (8.5, 9): 5,
        (9, 9.5): 6, (9.5, 10): 7, (10, 10.5): 8, (10.5, 11): 9, (11, 11.5): 10, (11.5, 12): 11,
        (12, 12.5): 0, (12.5, 13): 1, (13, 13.5): 2, (13.5, 14): 3, (14, 14.5): 4, (14.5, 15): 5,
        (15, 15.5): 6, (15.5, 16): 7, (16, 16.5): 8, (16.5, 17): 9, (17, 17.5): 10, (17.5, 18): 11,
        (18, 18.5): 0, (18.5, 19): 1, (19, 19.5): 2, (19.5, 20): 3, (20, 20.5): 4, (20.5, 21): 5,
        (21, 21.5): 6, (21.5, 22): 7, (22, 22.5): 8, (22.5, 23): 9, (23, 23.5): 10, (23.5, 24): 11,
        (24, 24.5): 0, (24.5, 25): 1, (25, 25.5): 2, (25.5, 26): 3, (26, 26.5): 4, (26.5, 27): 5,
        (27, 27.5): 6, (27.5, 28): 7, (28, 28.5): 8, (28.5, 29): 9, (29, 29.5): 10, (29.5, 30): 11
    },
    # Taurus - starts at Taurus
    1: {
        (0, 0.5): 1, (0.5, 1): 2, (1, 1.5): 3, (1.5, 2): 4, (2, 2.5): 5, (2.5, 3): 6,
        (3, 3.5): 7, (3.5, 4): 8, (4, 4.5): 9, (4.5, 5): 10, (5, 5.5): 11, (5.5, 6): 0,
        (6, 6.5): 1, (6.5, 7): 2, (7, 7.5): 3, (7.5, 8): 4, (8, 8.5): 5, (8.5, 9): 6,
        (9, 9.5): 7, (9.5, 10): 8, (10, 10.5): 9, (10.5, 11): 10, (11, 11.5): 11, (11.5, 12): 0,
        (12, 12.5): 1, (12.5, 13): 2, (13, 13.5): 3, (13.5, 14): 4, (14, 14.5): 5, (14.5, 15): 6,
        (15, 15.5): 7, (15.5, 16): 8, (16, 16.5): 9, (16.5, 17): 10, (17, 17.5): 11, (17.5, 18): 0,
        (18, 18.5): 1, (18.5, 19): 2, (19, 19.5): 3, (19.5, 20): 4, (20, 20.5): 5, (20.5, 21): 6,
        (21, 21.5): 7, (21.5, 22): 8, (22, 22.5): 9, (22.5, 23): 10, (23, 23.5): 11, (23.5, 24): 0,
        (24, 24.5): 1, (24.5, 25): 2, (25, 25.5): 3, (25.5, 26): 4, (26, 26.5): 5, (26.5, 27): 6,
        (27, 27.5): 7, (27.5, 28): 8, (28, 28.5): 9, (28.5, 29): 10, (29, 29.5): 11, (29.5, 30): 0
    },
    # Gemini - starts at Gemini
    2: {
        (0, 0.5): 2, (0.5, 1): 3, (1, 1.5): 4, (1.5, 2): 5, (2, 2.5): 6, (2.5, 3): 7,
        (3, 3.5): 8, (3.5, 4): 9, (4, 4.5): 10, (4.5, 5): 11, (5, 5.5): 0, (5.5, 6): 1,
        (6, 6.5): 2, (6.5, 7): 3, (7, 7.5): 4, (7.5, 8): 5, (8, 8.5): 6, (8.5, 9): 7,
        (9, 9.5): 8, (9.5, 10): 9, (10, 10.5): 10, (10.5, 11): 11, (11, 11.5): 0, (11.5, 12): 1,
        (12, 12.5): 2, (12.5, 13): 3, (13, 13.5): 4, (13.5, 14): 5, (14, 14.5): 6, (14.5, 15): 7,
        (15, 15.5): 8, (15.5, 16): 9, (16, 16.5): 10, (16.5, 17): 11, (17, 17.5): 0, (17.5, 18): 1,
        (18, 18.5): 2, (18.5, 19): 3, (19, 19.5): 4, (19.5, 20): 5, (20, 20.5): 6, (20.5, 21): 7,
        (21, 21.5): 8, (21.5, 22): 9, (22, 22.5): 10, (22.5, 23): 11, (23, 23.5): 0, (23.5, 24): 1,
        (24, 24.5): 2, (24.5, 25): 3, (25, 25.5): 4, (25.5, 26): 5, (26, 26.5): 6, (26.5, 27): 7,
        (27, 27.5): 8, (27.5, 28): 9, (28, 28.5): 10, (28.5, 29): 11, (29, 29.5): 0, (29.5, 30): 1
    },
    # Cancer - starts at Cancer
    3: {
        (0, 0.5): 3, (0.5, 1): 4, (1, 1.5): 5, (1.5, 2): 6, (2, 2.5): 7, (2.5, 3): 8,
        (3, 3.5): 9, (3.5, 4): 10, (4, 4.5): 11, (4.5, 5): 0, (5, 5.5): 1, (5.5, 6): 2,
        (6, 6.5): 3, (6.5, 7): 4, (7, 7.5): 5, (7.5, 8): 6, (8, 8.5): 7, (8.5, 9): 8,
        (9, 9.5): 9, (9.5, 10): 10, (10, 10.5): 11, (10.5, 11): 0, (11, 11.5): 1, (11.5, 12): 2,
        (12, 12.5): 3, (12.5, 13): 4, (13, 13.5): 5, (13.5, 14): 6, (14, 14.5): 7, (14.5, 15): 8,
        (15, 15.5): 9, (15.5, 16): 10, (16, 16.5): 11, (16.5, 17): 0, (17, 17.5): 1, (17.5, 18): 2,
        (18, 18.5): 3, (18.5, 19): 4, (19, 19.5): 5, (19.5, 20): 6, (20, 20.5): 7, (20.5, 21): 8,
        (21, 21.5): 9, (21.5, 22): 10, (22, 22.5): 11, (22.5, 23): 0, (23, 23.5): 1, (23.5, 24): 2,
        (24, 24.5): 3, (24.5, 25): 4, (25, 25.5): 5, (25.5, 26): 6, (26, 26.5): 7, (26.5, 27): 8,
        (27, 27.5): 9, (27.5, 28): 10, (28, 28.5): 11, (28.5, 29): 0, (29, 29.5): 1, (29.5, 30): 2
    },
    # Leo - starts at Leo
    4: {
        (0, 0.5): 4, (0.5, 1): 5, (1, 1.5): 6, (1.5, 2): 7, (2, 2.5): 8, (2.5, 3): 9,
        (3, 3.5): 10, (3.5, 4): 11, (4, 4.5): 0, (4.5, 5): 1, (5, 5.5): 2, (5.5, 6): 3,
        (6, 6.5): 4, (6.5, 7): 5, (7, 7.5): 6, (7.5, 8): 7, (8, 8.5): 8, (8.5, 9): 9,
        (9, 9.5): 10, (9.5, 10): 11, (10, 10.5): 0, (10.5, 11): 1, (11, 11.5): 2, (11.5, 12): 3,
        (12, 12.5): 4, (12.5, 13): 5, (13, 13.5): 6, (13.5, 14): 7, (14, 14.5): 8, (14.5, 15): 9,
        (15, 15.5): 10, (15.5, 16): 11, (16, 16.5): 0, (16.5, 17): 1, (17, 17.5): 2, (17.5, 18): 3,
        (18, 18.5): 4, (18.5, 19): 5, (19, 19.5): 6, (19.5, 20): 7, (20, 20.5): 8, (20.5, 21): 9,
        (21, 21.5): 10, (21.5, 22): 11, (22, 22.5): 0, (22.5, 23): 1, (23, 23.5): 2, (23.5, 24): 3,
        (24, 24.5): 4, (24.5, 25): 5, (25, 25.5): 6, (25.5, 26): 7, (26, 26.5): 8, (26.5, 27): 9,
        (27, 27.5): 10, (27.5, 28): 11, (28, 28.5): 0, (28.5, 29): 1, (29, 29.5): 2, (29.5, 30): 3
    },
    # Virgo - starts at Virgo
    5: {
        (0, 0.5): 5, (0.5, 1): 6, (1, 1.5): 7, (1.5, 2): 8, (2, 2.5): 9, (2.5, 3): 10,
        (3, 3.5): 11, (3.5, 4): 0, (4, 4.5): 1, (4.5, 5): 2, (5, 5.5): 3, (5.5, 6): 4,
        (6, 6.5): 5, (6.5, 7): 6, (7, 7.5): 7, (7.5, 8): 8, (8, 8.5): 9, (8.5, 9): 10,
        (9, 9.5): 11, (9.5, 10): 0, (10, 10.5): 1, (10.5, 11): 2, (11, 11.5): 3, (11.5, 12): 4,
        (12, 12.5): 5, (12.5, 13): 6, (13, 13.5): 7, (13.5, 14): 8, (14, 14.5): 9, (14.5, 15): 10,
        (15, 15.5): 11, (15.5, 16): 0, (16, 16.5): 1, (16.5, 17): 2, (17, 17.5): 3, (17.5, 18): 4,
        (18, 18.5): 5, (18.5, 19): 6, (19, 19.5): 7, (19.5, 20): 8, (20, 20.5): 9, (20.5, 21): 10,
        (21, 21.5): 11, (21.5, 22): 0, (22, 22.5): 1, (22.5, 23): 2, (23, 23.5): 3, (23.5, 24): 4,
        (24, 24.5): 5, (24.5, 25): 6, (25, 25.5): 7, (25.5, 26): 8, (26, 26.5): 9, (26.5, 27): 10,
        (27, 27.5): 11, (27.5, 28): 0, (28, 28.5): 1, (28.5, 29): 2, (29, 29.5): 3, (29.5, 30): 4
    },
    # Libra - starts at Libra
    6: {
        (0, 0.5): 6, (0.5, 1): 7, (1, 1.5): 8, (1.5, 2): 9, (2, 2.5): 10, (2.5, 3): 11,
        (3, 3.5): 0, (3.5, 4): 1, (4, 4.5): 2, (4.5, 5): 3, (5, 5.5): 4, (5.5, 6): 5,
        (6, 6.5): 6, (6.5, 7): 7, (7, 7.5): 8, (7.5, 8): 9, (8, 8.5): 10, (8.5, 9): 11,
        (9, 9.5): 0, (9.5, 10): 1, (10, 10.5): 2, (10.5, 11): 3, (11, 11.5): 4, (11.5, 12): 5,
        (12, 12.5): 6, (12.5, 13): 7, (13, 13.5): 8, (13.5, 14): 9, (14, 14.5): 10, (14.5, 15): 11,
        (15, 15.5): 0, (15.5, 16): 1, (16, 16.5): 2, (16.5, 17): 3, (17, 17.5): 4, (17.5, 18): 5,
        (18, 18.5): 6, (18.5, 19): 7, (19, 19.5): 8, (19.5, 20): 9, (20, 20.5): 10, (20.5, 21): 11,
        (21, 21.5): 0, (21.5, 22): 1, (22, 22.5): 2, (22.5, 23): 3, (23, 23.5): 4, (23.5, 24): 5,
        (24, 24.5): 6, (24.5, 25): 7, (25, 25.5): 8, (25.5, 26): 9, (26, 26.5): 10, (26.5, 27): 11,
        (27, 27.5): 0, (27.5, 28): 1, (28, 28.5): 2, (28.5, 29): 3, (29, 29.5): 4, (29.5, 30): 5
    },
    # Scorpio - starts at Scorpio
    7: {
        (0, 0.5): 7, (0.5, 1): 8, (1, 1.5): 9, (1.5, 2): 10, (2, 2.5): 11, (2.5, 3): 0,
        (3, 3.5): 1, (3.5, 4): 2, (4, 4.5): 3, (4.5, 5): 4, (5, 5.5): 5, (5.5, 6): 6,
        (6, 6.5): 7, (6.5, 7): 8, (7, 7.5): 9, (7.5, 8): 10, (8, 8.5): 11, (8.5, 9): 0,
        (9, 9.5): 1, (9.5, 10): 2, (10, 10.5): 3, (10.5, 11): 4, (11, 11.5): 5, (11.5, 12): 6,
        (12, 12.5): 7, (12.5, 13): 8, (13, 13.5): 9, (13.5, 14): 10, (14, 14.5): 11, (14.5, 15): 0,
        (15, 15.5): 1, (15.5, 16): 2, (16, 16.5): 3, (16.5, 17): 4, (17, 17.5): 5, (17.5, 18): 6,
        (18, 18.5): 7, (18.5, 19): 8, (19, 19.5): 9, (19.5, 20): 10, (20, 20.5): 11, (20.5, 21): 0,
        (21, 21.5): 1, (21.5, 22): 2, (22, 22.5): 3, (22.5, 23): 4, (23, 23.5): 5, (23.5, 24): 6,
        (24, 24.5): 7, (24.5, 25): 8, (25, 25.5): 9, (25.5, 26): 10, (26, 26.5): 11, (26.5, 27): 0,
        (27, 27.5): 1, (27.5, 28): 2, (28, 28.5): 3, (28.5, 29): 4, (29, 29.5): 5, (29.5, 30): 6
    },
    # Sagittarius - starts at Sagittarius
    8: {
        (0, 0.5): 8, (0.5, 1): 9, (1, 1.5): 10, (1.5, 2): 11, (2, 2.5): 0, (2.5, 3): 1,
        (3, 3.5): 2, (3.5, 4): 3, (4, 4.5): 4, (4.5, 5): 5, (5, 5.5): 6, (5.5, 6): 7,
        (6, 6.5): 8, (6.5, 7): 9, (7, 7.5): 10, (7.5, 8): 11, (8, 8.5): 0, (8.5, 9): 1,
        (9, 9.5): 2, (9.5, 10): 3, (10, 10.5): 4, (10.5, 11): 5, (11, 11.5): 6, (11.5, 12): 7,
        (12, 12.5): 8, (12.5, 13): 9, (13, 13.5): 10, (13.5, 14): 11, (14, 14.5): 0, (14.5, 15): 1,
        (15, 15.5): 2, (15.5, 16): 3, (16, 16.5): 4, (16.5, 17): 5, (17, 17.5): 6, (17.5, 18): 7,
        (18, 18.5): 8, (18.5, 19): 9, (19, 19.5): 10, (19.5, 20): 11, (20, 20.5): 0, (20.5, 21): 1,
        (21, 21.5): 2, (21.5, 22): 3, (22, 22.5): 4, (22.5, 23): 5, (23, 23.5): 6, (23.5, 24): 7,
        (24, 24.5): 8, (24.5, 25): 9, (25, 25.5): 10, (25.5, 26): 11, (26, 26.5): 0, (26.5, 27): 1,
        (27, 27.5): 2, (27.5, 28): 3, (28, 28.5): 4, (28.5, 29): 5, (29, 29.5): 6, (29.5, 30): 7
    },
    # Capricorn - starts at Capricorn
    9: {
        (0, 0.5): 9, (0.5, 1): 10, (1, 1.5): 11, (1.5, 2): 0, (2, 2.5): 1, (2.5, 3): 2,
        (3, 3.5): 3, (3.5, 4): 4, (4, 4.5): 5, (4.5, 5): 6, (5, 5.5): 7, (5.5, 6): 8,
        (6, 6.5): 9, (6.5, 7): 10, (7, 7.5): 11, (7.5, 8): 0, (8, 8.5): 1, (8.5, 9): 2,
        (9, 9.5): 3, (9.5, 10): 4, (10, 10.5): 5, (10.5, 11): 6, (11, 11.5): 7, (11.5, 12): 8,
        (12, 12.5): 9, (12.5, 13): 10, (13, 13.5): 11, (13.5, 14): 0, (14, 14.5): 1, (14.5, 15): 2,
        (15, 15.5): 3, (15.5, 16): 4, (16, 16.5): 5, (16.5, 17): 6, (17, 17.5): 7, (17.5, 18): 8,
        (18, 18.5): 9, (18.5, 19): 10, (19, 19.5): 11, (19.5, 20): 0, (20, 20.5): 1, (20.5, 21): 2,
        (21, 21.5): 3, (21.5, 22): 4, (22, 22.5): 5, (22.5, 23): 6, (23, 23.5): 7, (23.5, 24): 8,
        (24, 24.5): 9, (24.5, 25): 10, (25, 25.5): 11, (25.5, 26): 0, (26, 26.5): 1, (26.5, 27): 2,
        (27, 27.5): 3, (27.5, 28): 4, (28, 28.5): 5, (28.5, 29): 6, (29, 29.5): 7, (29.5, 30): 8
    },
    # Aquarius - starts at Aquarius
    10: {
        (0, 0.5): 10, (0.5, 1): 11, (1, 1.5): 0, (1.5, 2): 1, (2, 2.5): 2, (2.5, 3): 3,
        (3, 3.5): 4, (3.5, 4): 5, (4, 4.5): 6, (4.5, 5): 7, (5, 5.5): 8, (5.5, 6): 9,
        (6, 6.5): 10, (6.5, 7): 11, (7, 7.5): 0, (7.5, 8): 1, (8, 8.5): 2, (8.5, 9): 3,
        (9, 9.5): 4, (9.5, 10): 5, (10, 10.5): 6, (10.5, 11): 7, (11, 11.5): 8, (11.5, 12): 9,
        (12, 12.5): 10, (12.5, 13): 11, (13, 13.5): 0, (13.5, 14): 1, (14, 14.5): 2, (14.5, 15): 3,
        (15, 15.5): 4, (15.5, 16): 5, (16, 16.5): 6, (16.5, 17): 7, (17, 17.5): 8, (17.5, 18): 9,
        (18, 18.5): 10, (18.5, 19): 11, (19, 19.5): 0, (19.5, 20): 1, (20, 20.5): 2, (20.5, 21): 3,
        (21, 21.5): 4, (21.5, 22): 5, (22, 22.5): 6, (22.5, 23): 7, (23, 23.5): 8, (23.5, 24): 9,
        (24, 24.5): 10, (24.5, 25): 11, (25, 25.5): 0, (25.5, 26): 1, (26, 26.5): 2, (26.5, 27): 3,
        (27, 27.5): 4, (27.5, 28): 5, (28, 28.5): 6, (28.5, 29): 7, (29, 29.5): 8, (29.5, 30): 9
    },
    # Pisces - starts at Pisces
    11: {
        (0, 0.5): 11, (0.5, 1): 0, (1, 1.5): 1, (1.5, 2): 2, (2, 2.5): 3, (2.5, 3): 4,
        (3, 3.5): 5, (3.5, 4): 6, (4, 4.5): 7, (4.5, 5): 8, (5, 5.5): 9, (5.5, 6): 10,
        (6, 6.5): 11, (6.5, 7): 0, (7, 7.5): 1, (7.5, 8): 2, (8, 8.5): 3, (8.5, 9): 4,
        (9, 9.5): 5, (9.5, 10): 6, (10, 10.5): 7, (10.5, 11): 8, (11, 11.5): 9, (11.5, 12): 10,
        (12, 12.5): 11, (12.5, 13): 0, (13, 13.5): 1, (13.5, 14): 2, (14, 14.5): 3, (14.5, 15): 4,
        (15, 15.5): 5, (15.5, 16): 6, (16, 16.5): 7, (16.5, 17): 8, (17, 17.5): 9, (17.5, 18): 10,
        (18, 18.5): 11, (18.5, 19): 0, (19, 19.5): 1, (19.5, 20): 2, (20, 20.5): 3, (20.5, 21): 4,
        (21, 21.5): 5, (21.5, 22): 6, (22, 22.5): 7, (22.5, 23): 8, (23, 23.5): 9, (23.5, 24): 10,
        (24, 24.5): 11, (24.5, 25): 0, (25, 25.5): 1, (25.5, 26): 2, (26, 26.5): 3, (26.5, 27): 4,
        (27, 27.5): 5, (27.5, 28): 6, (28, 28.5): 7, (28.5, 29): 8, (29, 29.5): 9, (29.5, 30): 10
    }
}


# ============================================================================
# D30 - TRIMSAMSA TABLE (Non-uniform divisions for misfortune/diseases)
# ============================================================================
# Source: VedAstro reference - PENDING EXTRACTION FROM VARGAS.CS
# Note: This table needs to be extracted from VedAstro's Vargas.cs
# D30 uses non-uniform divisions unlike D45 and D60

D30_TABLE = {
    # TODO: Extract from VedAstro Vargas.cs
    # Odd signs: Mars(5°), Saturn(5°), Jupiter(8°), Mercury(7°), Venus(5°)
    # Even signs: Venus(5°), Mercury(7°), Jupiter(8°), Saturn(5°), Mars(5°)
}


# ============================================================================
# PUBLIC API FUNCTIONS
# ============================================================================

def calculate_d45(longitude: float) -> float:
    """
    Calculate D45 (Akshavedamsha) using VedAstro lookup tables
    
    Args:
        longitude: Sidereal longitude in degrees (0-360)
    
    Returns:
        D45 longitude in degrees (0-360)
    """
    sign_num = int(longitude / 30)
    degree_in_sign = longitude % 30
    
    result_sign, degree_within_division = _lookup_varga(
        sign_num, degree_in_sign, D45_TABLE, 45
    )
    
    return (result_sign * 30) + degree_within_division


def calculate_d60(longitude: float) -> float:
    """
    Calculate D60 (Shashtyamsha) using VedAstro lookup tables
    
    Args:
        longitude: Sidereal longitude in degrees (0-360)
    
    Returns:
        D60 longitude in degrees (0-360)
    """
    sign_num = int(longitude / 30)
    degree_in_sign = longitude % 30
    
    result_sign, degree_within_division = _lookup_varga(
        sign_num, degree_in_sign, D60_TABLE, 60
    )
    
    return (result_sign * 30) + degree_within_division


def calculate_d30(longitude: float) -> float:
    """
    Calculate D30 (Trimsamsa) using VedAstro lookup tables
    
    Args:
        longitude: Sidereal longitude in degrees (0-360)
    
    Returns:
        D30 longitude in degrees (0-360)
    
    Note: This implementation is PENDING until D30 table is extracted from VedAstro
    """
    # TODO: Implement after extracting D30 table from Vargas.cs
    # For now, return the original longitude as fallback
    return longitude


def get_divisional_sign(longitude: float, division: int) -> str:
    """
    Get the zodiac sign name for a divisional chart position
    
    Args:
        longitude: Divisional chart longitude (0-360)
        division: Division number (30, 45, 60)
    
    Returns:
        Sign name (e.g., 'Aries', 'Taurus')
    """
    sign_num = int(longitude / 30) % 12
    return SIGN_NAMES[sign_num]


# ============================================================================
# COMPARISON WITH OLD IMPLEMENTATION
# ============================================================================

def compare_implementations(test_longitudes: list = None):
    """
    Compare old algorithmic approach with new lookup table approach
    
    This is for testing/validation purposes only
    """
    if test_longitudes is None:
        # Test with various positions across all signs
        test_longitudes = [
            0.0,      # 0° Aries
            15.5,     # 15°30' Aries
            29.9,     # 29°54' Aries
            45.25,    # 15°15' Taurus
            90.0,     # 0° Cancer
            180.0,    # 0° Libra
            270.0,    # 0° Capricorn
            359.9     # 29°54' Pisces
        ]
    
    print("Comparison of Divisional Chart Implementations")
    print("=" * 80)
    
    for lon in test_longitudes:
        sign_num = int(lon / 30)
        deg_in_sign = lon % 30
        
        print(f"\nTest: {SIGN_NAMES[sign_num]} {deg_in_sign:.2f}° (Longitude: {lon:.2f}°)")
        print("-" * 80)
        
        # D45
        d45_new = calculate_d45(lon)
        d45_sign = get_divisional_sign(d45_new, 45)
        print(f"  D45: {d45_sign} {d45_new % 30:.2f}° (New Lookup Table)")
        
        # D60
        d60_new = calculate_d60(lon)
        d60_sign = get_divisional_sign(d60_new, 60)
        print(f"  D60: {d60_sign} {d60_new % 30:.2f}° (New Lookup Table)")


if __name__ == "__main__":
    # Run comparison tests
    compare_implementations()